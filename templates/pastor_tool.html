{% extends "base.html" %}
{% block title %}Pastor's Tool - District 4 Tool{% endblock %}

{% block content %}
<section class="card">
  <h2>Pastor's Tool</h2>

  <form method="get" class="month-picker">
    <div class="field-group">
      <label for="month">Month</label>
      <select id="month" name="month">
        {% for name, value in month_names %}
          <option value="{{ value }}" {% if value == month %}selected{% endif %}>{{ name }}</option>
        {% endfor %}
      </select>
    </div>

    <div class="field-group">
      <label for="year">Year</label>
      <select id="year" name="year">
        {% for y in year_options %}
          <option value="{{ y }}" {% if y == year %}selected{% endif %}>
            {{ y }}{% if submitted_map.get((y, month)) %} âœ“{% endif %}
          </option>
        {% endfor %}
      </select>
    </div>

    <button type="submit" class="btn-secondary">Go</button>
  </form>

  <div class="sunday-list">
    {% if sunday_list %}
      {% for s in sunday_list %}
        <a href="{{ url_for('sunday_detail', year=s.year, month=s.month, day=s.day) }}"
           class="sunday-card {% if s.is_complete %}complete{% else %}incomplete{% endif %}">
          <span>{{ s.display }}</span>
          <span class="status-pill">
            {% if s.is_complete %}Complete{% else %}Missing Data{% endif %}
          </span>
        </a>
      {% endfor %}
    {% else %}
      <p>No Sundays found for this month.</p>
    {% endif %}
  </div>

  <div class="progress-row">
    <a href="{{ url_for('church_progress_view', year=year, month=month) }}"
       class="btn-secondary">
      Church Progress
    </a>
    <span class="badge
      {% if cp_complete %}badge-success{% else %}badge-warning{% endif %}">
      {% if cp_complete %}Church Progress Complete{% else %}Church Progress Incomplete{% endif %}
    </span>
  </div>

  <form method="post" class="submit-row">
    <button type="submit"
            class="btn-primary {% if not can_submit %}btn-disabled{% endif %}"
            {% if not can_submit %}disabled{% endif %}>
      {% if status_key == 'not_submitted' %}Submit{% else %}Resubmit{% endif %}
    </button>

    <div class="status-box
        {% if status_key == 'not_submitted' %}status-neutral
        {% elif status_key == 'pending' %}status-pending
        {% elif status_key == 'approved' %}status-approved
        {% endif %}">
      {% if status_key == 'not_submitted' %}
        Not submitted
      {% elif status_key == 'pending' %}
        Pending AO approval
      {% elif status_key == 'approved' %}
        Approved by AO
      {% endif %}
    </div>
  </form>

  <p class="muted small">
    Submit/Resubmit is enabled only when all Sunday reports for the month are complete (green)
    <strong>and</strong> the Church Progress form is complete.
  </p>
</section>
{% endblock %}
