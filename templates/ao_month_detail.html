{% extends "base.html" %}

{% block content %}
<div class="card">
  <h1>Church status â€“ {{ month_label }}</h1>

  <p>
    <strong>Church:</strong> {{ sheet_stats.church or "N/A" }}<br>
    <strong>Pastor:</strong> {{ sheet_stats.pastor or "N/A" }}<br>
    <strong>Address:</strong> {{ sheet_stats.address or "N/A" }}<br>
    <strong>Rows in Report sheet this month:</strong> {{ sheet_stats.rows }}
  </p>

  <h2>Current status</h2>
  <p>
    <strong>Pastor tool status:</strong>
    {% if status_key == "approved" %}
      Approved
    {% elif status_key == "pending" %}
      Pending AO approval
    {% elif status_key == "not_submitted" %}
      Not submitted
    {% else %}
      Unknown
    {% endif %}
    <br>
    <strong>Sheet status (from Report):</strong>
    {{ sheet_stats.sheet_status or "N/A" }}
  </p>

  <h2>Attendance & Spiritual (Averages)</h2>
  {% if sheet_stats.rows > 0 %}
  <table class="table">
    <thead>
      <tr>
        <th>Adult</th>
        <th>Youth</th>
        <th>Children</th>
        <th>Received Jesus</th>
        <th>Existing Bible Study</th>
        <th>New Bible Study</th>
        <th>Water Baptized</th>
        <th>Holy Spirit Baptized</th>
        <th>Children's Dedication</th>
        <th>Healed</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>{{ "%.2f"|format(sheet_stats.avg.adult) }}</td>
        <td>{{ "%.2f"|format(sheet_stats.avg.youth) }}</td>
        <td>{{ "%.2f"|format(sheet_stats.avg.children) }}</td>
        <td>{{ "%.2f"|format(sheet_stats.avg.received_jesus) }}</td>
        <td>{{ "%.2f"|format(sheet_stats.avg.existing_bible_study) }}</td>
        <td>{{ "%.2f"|format(sheet_stats.avg.new_bible_study) }}</td>
        <td>{{ "%.2f"|format(sheet_stats.avg.water_baptized) }}</td>
        <td>{{ "%.2f"|format(sheet_stats.avg.holy_spirit_baptized) }}</td>
        <td>{{ "%.2f"|format(sheet_stats.avg.childrens_dedication) }}</td>
        <td>{{ "%.2f"|format(sheet_stats.avg.healed) }}</td>
      </tr>
    </tbody>
  </table>
  {% else %}
    <p>No rows found in the Report sheet for this month.</p>
  {% endif %}

  <h2>Financial (Totals for the month)</h2>
  <table class="table">
    <thead>
      <tr>
        <th>Tithes</th>
        <th>Offering</th>
        <th>Personal Tithes</th>
        <th>Mission Offering</th>
        <th>Total Amount to Send</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>{{ "%.2f"|format(sheet_stats.totals.tithes) }}</td>
        <td>{{ "%.2f"|format(sheet_stats.totals.offering) }}</td>
        <td>{{ "%.2f"|format(sheet_stats.totals.personal_tithes) }}</td>
        <td>{{ "%.2f"|format(sheet_stats.totals.mission_offering) }}</td>
        <td>{{ "%.2f"|format(sheet_stats.totals.amount_to_send) }}</td>
      </tr>
    </tbody>
  </table>

  <h2>Approval</h2>
  <p>
    <strong>Submitted at:</strong>
    {% if submitted_at %}
      {{ submitted_at }}
    {% else %}
      Not yet submitted
    {% endif %}
    <br>
    <strong>Approved at:</strong>
    {% if approved_at %}
      {{ approved_at }}
    {% else %}
      Not yet approved
    {% endif %}
  </p>

  {% if can_approve %}
  <form method="post" style="margin-top: 1rem;">
    <button name="action" value="approve" class="btn-primary">Approve</button>
    <button name="action" value="pending" class="btn-secondary">Set as Pending</button>
    <a href="{{ url_for('ao_tool', year=year) }}" class="btn-secondary">Back to Year</a>
  </form>
  {% else %}
    <p>This month cannot be approved yet (report not submitted).</p>
    <a href="{{ url_for('ao_tool', year=year) }}" class="btn-secondary">Back to Year</a>
  {% endif %}
</div>
{% endblock %}
