{% extends "base.html" %}
{% block title %}Church Progress - District 4 Tool{% endblock %}

{% block content %}
<section class="card">
  <h2>Church Progress</h2>
  <p class="muted">Month: {{ date_label }}</p>

  <a href="{{ url_for('pastor_tool', year=year, month=month) }}"
     class="btn-secondary back-btn">← Back to Pastor's Tool</a>

  {% if error %}
    <div class="alert alert-error">
      {{ error }}
    </div>
  {% endif %}

  <form method="post" class="form-vertical">
    <h3># Bible Studies</h3>
    <div class="field-group">
      <label for="bible_new">New</label>
      <input type="number" id="bible_new" name="bible_new" value="{{ values.bible_new }}">
    </div>
    <div class="field-group">
      <label for="bible_existing">Existing</label>
      <input type="number" id="bible_existing" name="bible_existing" value="{{ values.bible_existing }}">
    </div>

    <h3>Conversions & Baptism</h3>
    <div class="field-group">
      <label for="received_christ"># Received Christ</label>
      <input type="number" id="received_christ" name="received_christ" value="{{ values.received_christ }}">
    </div>
    <div class="field-group">
      <label for="baptized_water"># Baptized - Water</label>
      <input type="number" id="baptized_water" name="baptized_water" value="{{ values.baptized_water }}">
    </div>
    <div class="field-group">
      <label for="baptized_holy_spirit"># Baptized - Holy Spirit</label>
      <input type="number" id="baptized_holy_spirit" name="baptized_holy_spirit" value="{{ values.baptized_holy_spirit }}">
    </div>

    <h3>Healings & Dedication</h3>
    <div class="field-group">
      <label for="healed"># Healed</label>
      <input type="number" id="healed" name="healed" value="{{ values.healed }}">
    </div>
    <div class="field-group">
      <label for="child_dedication"># Child Dedication</label>
      <input type="number" id="child_dedication" name="child_dedication" value="{{ values.child_dedication }}">
    </div>

    <h3>Total Monthly Amount</h3>
    <div class="field-group">
      <label for="monthly_total">Total Amount for This Month</label>
      <div class="peso-box">
        <span class="peso-symbol">₱</span>
        <input type="text" id="monthly_total" class="readonly-input peso-input" readonly>
      </div>
    </div>

    <p class="muted small">
      All Church Progress fields are required for the month. Values must be whole numbers.
    </p>

    <button type="submit" class="btn-primary">Save Progress</button>
  </form>
</section>

<script>
  (function () {
    function calculateMonthlyTotal() {
      fetch("{{ url_for('pastor_tool', year=year, month=month) }}?json=1")
        .then(r => r.json())
        .then(data => {
          if (!data.totals) return;
          var total = data.totals.total_amount || 0;
          var box = document.getElementById("monthly_total");
          if (box) box.value = total.toFixed(2);
        })
        .catch(() => {});
    }

    calculateMonthlyTotal();
  })();
</script>
{% endblock %}
